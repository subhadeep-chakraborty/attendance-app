<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mark Attendance - Class Monitor App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<header>
    <h1>Class Monitor App</h1>
    <nav aria-label="Teacher navigation">
        <a th:href="@{/teacher}">Dashboard</a> |
        <a th:href="@{/mark-attendance}">Mark Attendance</a> |
        <a th:href="@{/record-grades}">Record Grades</a> |
        <a th:href="@{/logout}">Logout</a>
    </nav>
</header>

<main>
    <h2>Mark Attendance</h2>
    <form th:action="@{/mark-attendance}" method="post">
        <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>

        <label for="class">Class:</label>
        <select id="class" name="class" required>
            <option value="" disabled selected>Select a subject</option>
            <option th:each="subject : ${subjects}"
                    th:value="${subject.id}"
                    th:text="${subject.name}">
            </option>
        </select>

        <table id="students-table">
            <thead>
            <tr>
                <th>Student</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <button type="submit">Save</button>
    </form>
</main>

<script>
    $('#class').change(function() {
        let subjectId = $(this).val();
        $.get('/get-students', { subjectId: subjectId }, function(students) {
            let rows = '';
            students.forEach(function(student) {
                rows += '<tr><td>' + student.name + '</td>' +
                    '<td><select name="status_' + student.email + '"><option>Present</option><option>Absent</option></select></td></tr>';
            });
            $('#students-table tbody').html(rows);
        });
    });
</script>

</body>
</html>
